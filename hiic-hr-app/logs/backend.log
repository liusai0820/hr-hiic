Requirement already satisfied: fastapi>=0.115.0 in ./venv/lib/python3.9/site-packages (from -r requirements.txt (line 1)) (0.115.11)
Requirement already satisfied: uvicorn>=0.34.0 in ./venv/lib/python3.9/site-packages (from -r requirements.txt (line 2)) (0.34.0)
Requirement already satisfied: langchain>=0.3.0 in ./venv/lib/python3.9/site-packages (from -r requirements.txt (line 3)) (0.3.20)
Requirement already satisfied: python-dotenv>=1.0.0 in ./venv/lib/python3.9/site-packages (from -r requirements.txt (line 4)) (1.0.1)
Requirement already satisfied: pandas>=2.0.0 in ./venv/lib/python3.9/site-packages (from -r requirements.txt (line 5)) (2.2.3)
Requirement already satisfied: matplotlib>=3.0.0 in ./venv/lib/python3.9/site-packages (from -r requirements.txt (line 6)) (3.9.4)
Requirement already satisfied: seaborn>=0.13.0 in ./venv/lib/python3.9/site-packages (from -r requirements.txt (line 7)) (0.13.2)
Requirement already satisfied: supabase>=2.0.0 in ./venv/lib/python3.9/site-packages (from -r requirements.txt (line 8)) (2.13.0)
Requirement already satisfied: pydantic>=2.0.0 in ./venv/lib/python3.9/site-packages (from -r requirements.txt (line 9)) (2.10.6)
Requirement already satisfied: requests>=2.31.0 in ./venv/lib/python3.9/site-packages (from -r requirements.txt (line 10)) (2.32.3)
Requirement already satisfied: starlette<0.47.0,>=0.40.0 in ./venv/lib/python3.9/site-packages (from fastapi>=0.115.0->-r requirements.txt (line 1)) (0.46.1)
Requirement already satisfied: typing-extensions>=4.8.0 in ./venv/lib/python3.9/site-packages (from fastapi>=0.115.0->-r requirements.txt (line 1)) (4.12.2)
Requirement already satisfied: h11>=0.8 in ./venv/lib/python3.9/site-packages (from uvicorn>=0.34.0->-r requirements.txt (line 2)) (0.14.0)
Requirement already satisfied: click>=7.0 in ./venv/lib/python3.9/site-packages (from uvicorn>=0.34.0->-r requirements.txt (line 2)) (8.1.8)
Requirement already satisfied: async-timeout<5.0.0,>=4.0.0 in ./venv/lib/python3.9/site-packages (from langchain>=0.3.0->-r requirements.txt (line 3)) (4.0.3)
Requirement already satisfied: langchain-text-splitters<1.0.0,>=0.3.6 in ./venv/lib/python3.9/site-packages (from langchain>=0.3.0->-r requirements.txt (line 3)) (0.3.6)
Requirement already satisfied: SQLAlchemy<3,>=1.4 in ./venv/lib/python3.9/site-packages (from langchain>=0.3.0->-r requirements.txt (line 3)) (2.0.39)
Requirement already satisfied: langchain-core<1.0.0,>=0.3.41 in ./venv/lib/python3.9/site-packages (from langchain>=0.3.0->-r requirements.txt (line 3)) (0.3.45)
Requirement already satisfied: PyYAML>=5.3 in ./venv/lib/python3.9/site-packages (from langchain>=0.3.0->-r requirements.txt (line 3)) (6.0.2)
Requirement already satisfied: langsmith<0.4,>=0.1.17 in ./venv/lib/python3.9/site-packages (from langchain>=0.3.0->-r requirements.txt (line 3)) (0.3.13)
Requirement already satisfied: pytz>=2020.1 in ./venv/lib/python3.9/site-packages (from pandas>=2.0.0->-r requirements.txt (line 5)) (2025.1)
Requirement already satisfied: numpy>=1.22.4 in ./venv/lib/python3.9/site-packages (from pandas>=2.0.0->-r requirements.txt (line 5)) (2.0.2)
Requirement already satisfied: python-dateutil>=2.8.2 in ./venv/lib/python3.9/site-packages (from pandas>=2.0.0->-r requirements.txt (line 5)) (2.9.0.post0)
Requirement already satisfied: tzdata>=2022.7 in ./venv/lib/python3.9/site-packages (from pandas>=2.0.0->-r requirements.txt (line 5)) (2025.1)
Requirement already satisfied: pillow>=8 in ./venv/lib/python3.9/site-packages (from matplotlib>=3.0.0->-r requirements.txt (line 6)) (11.1.0)
Requirement already satisfied: pyparsing>=2.3.1 in ./venv/lib/python3.9/site-packages (from matplotlib>=3.0.0->-r requirements.txt (line 6)) (3.2.1)
Requirement already satisfied: packaging>=20.0 in ./venv/lib/python3.9/site-packages (from matplotlib>=3.0.0->-r requirements.txt (line 6)) (24.2)
Requirement already satisfied: contourpy>=1.0.1 in ./venv/lib/python3.9/site-packages (from matplotlib>=3.0.0->-r requirements.txt (line 6)) (1.3.0)
Requirement already satisfied: kiwisolver>=1.3.1 in ./venv/lib/python3.9/site-packages (from matplotlib>=3.0.0->-r requirements.txt (line 6)) (1.4.7)
Requirement already satisfied: importlib-resources>=3.2.0 in ./venv/lib/python3.9/site-packages (from matplotlib>=3.0.0->-r requirements.txt (line 6)) (6.5.2)
Requirement already satisfied: fonttools>=4.22.0 in ./venv/lib/python3.9/site-packages (from matplotlib>=3.0.0->-r requirements.txt (line 6)) (4.56.0)
Requirement already satisfied: cycler>=0.10 in ./venv/lib/python3.9/site-packages (from matplotlib>=3.0.0->-r requirements.txt (line 6)) (0.12.1)
Requirement already satisfied: storage3<0.12,>=0.10 in ./venv/lib/python3.9/site-packages (from supabase>=2.0.0->-r requirements.txt (line 8)) (0.11.3)
Requirement already satisfied: supafunc<0.10,>=0.9 in ./venv/lib/python3.9/site-packages (from supabase>=2.0.0->-r requirements.txt (line 8)) (0.9.3)
Requirement already satisfied: gotrue<3.0.0,>=2.11.0 in ./venv/lib/python3.9/site-packages (from supabase>=2.0.0->-r requirements.txt (line 8)) (2.11.4)
Requirement already satisfied: httpx<0.29,>=0.26 in ./venv/lib/python3.9/site-packages (from supabase>=2.0.0->-r requirements.txt (line 8)) (0.28.1)
Requirement already satisfied: postgrest<0.20,>=0.19 in ./venv/lib/python3.9/site-packages (from supabase>=2.0.0->-r requirements.txt (line 8)) (0.19.3)
Requirement already satisfied: realtime<3.0.0,>=2.0.0 in ./venv/lib/python3.9/site-packages (from supabase>=2.0.0->-r requirements.txt (line 8)) (2.4.1)
Requirement already satisfied: annotated-types>=0.6.0 in ./venv/lib/python3.9/site-packages (from pydantic>=2.0.0->-r requirements.txt (line 9)) (0.7.0)
Requirement already satisfied: pydantic-core==2.27.2 in ./venv/lib/python3.9/site-packages (from pydantic>=2.0.0->-r requirements.txt (line 9)) (2.27.2)
Requirement already satisfied: urllib3<3,>=1.21.1 in ./venv/lib/python3.9/site-packages (from requests>=2.31.0->-r requirements.txt (line 10)) (2.3.0)
Requirement already satisfied: certifi>=2017.4.17 in ./venv/lib/python3.9/site-packages (from requests>=2.31.0->-r requirements.txt (line 10)) (2025.1.31)
Requirement already satisfied: charset-normalizer<4,>=2 in ./venv/lib/python3.9/site-packages (from requests>=2.31.0->-r requirements.txt (line 10)) (3.4.1)
Requirement already satisfied: idna<4,>=2.5 in ./venv/lib/python3.9/site-packages (from requests>=2.31.0->-r requirements.txt (line 10)) (3.10)
Requirement already satisfied: httpcore==1.* in ./venv/lib/python3.9/site-packages (from httpx<0.29,>=0.26->supabase>=2.0.0->-r requirements.txt (line 8)) (1.0.7)
Requirement already satisfied: anyio in ./venv/lib/python3.9/site-packages (from httpx<0.29,>=0.26->supabase>=2.0.0->-r requirements.txt (line 8)) (4.8.0)
Requirement already satisfied: h2<5,>=3 in ./venv/lib/python3.9/site-packages (from httpx<0.29,>=0.26->supabase>=2.0.0->-r requirements.txt (line 8)) (4.2.0)
Requirement already satisfied: hyperframe<7,>=6.1 in ./venv/lib/python3.9/site-packages (from h2<5,>=3->httpx<0.29,>=0.26->supabase>=2.0.0->-r requirements.txt (line 8)) (6.1.0)
Requirement already satisfied: hpack<5,>=4.1 in ./venv/lib/python3.9/site-packages (from h2<5,>=3->httpx<0.29,>=0.26->supabase>=2.0.0->-r requirements.txt (line 8)) (4.1.0)
Requirement already satisfied: zipp>=3.1.0 in ./venv/lib/python3.9/site-packages (from importlib-resources>=3.2.0->matplotlib>=3.0.0->-r requirements.txt (line 6)) (3.21.0)
Requirement already satisfied: tenacity!=8.4.0,<10.0.0,>=8.1.0 in ./venv/lib/python3.9/site-packages (from langchain-core<1.0.0,>=0.3.41->langchain>=0.3.0->-r requirements.txt (line 3)) (9.0.0)
Requirement already satisfied: jsonpatch<2.0,>=1.33 in ./venv/lib/python3.9/site-packages (from langchain-core<1.0.0,>=0.3.41->langchain>=0.3.0->-r requirements.txt (line 3)) (1.33)
Requirement already satisfied: jsonpointer>=1.9 in ./venv/lib/python3.9/site-packages (from jsonpatch<2.0,>=1.33->langchain-core<1.0.0,>=0.3.41->langchain>=0.3.0->-r requirements.txt (line 3)) (3.0.0)
Requirement already satisfied: requests-toolbelt<2.0.0,>=1.0.0 in ./venv/lib/python3.9/site-packages (from langsmith<0.4,>=0.1.17->langchain>=0.3.0->-r requirements.txt (line 3)) (1.0.0)
Requirement already satisfied: zstandard<0.24.0,>=0.23.0 in ./venv/lib/python3.9/site-packages (from langsmith<0.4,>=0.1.17->langchain>=0.3.0->-r requirements.txt (line 3)) (0.23.0)
Requirement already satisfied: orjson<4.0.0,>=3.9.14 in ./venv/lib/python3.9/site-packages (from langsmith<0.4,>=0.1.17->langchain>=0.3.0->-r requirements.txt (line 3)) (3.10.15)
Requirement already satisfied: deprecation<3.0.0,>=2.1.0 in ./venv/lib/python3.9/site-packages (from postgrest<0.20,>=0.19->supabase>=2.0.0->-r requirements.txt (line 8)) (2.1.0)
Requirement already satisfied: strenum<0.5.0,>=0.4.9 in ./venv/lib/python3.9/site-packages (from postgrest<0.20,>=0.19->supabase>=2.0.0->-r requirements.txt (line 8)) (0.4.15)
Requirement already satisfied: six>=1.5 in ./venv/lib/python3.9/site-packages (from python-dateutil>=2.8.2->pandas>=2.0.0->-r requirements.txt (line 5)) (1.17.0)
Requirement already satisfied: aiohttp<4.0.0,>=3.11.13 in ./venv/lib/python3.9/site-packages (from realtime<3.0.0,>=2.0.0->supabase>=2.0.0->-r requirements.txt (line 8)) (3.11.13)
Requirement already satisfied: websockets<15,>=11 in ./venv/lib/python3.9/site-packages (from realtime<3.0.0,>=2.0.0->supabase>=2.0.0->-r requirements.txt (line 8)) (14.2)
Requirement already satisfied: aiohappyeyeballs>=2.3.0 in ./venv/lib/python3.9/site-packages (from aiohttp<4.0.0,>=3.11.13->realtime<3.0.0,>=2.0.0->supabase>=2.0.0->-r requirements.txt (line 8)) (2.6.1)
Requirement already satisfied: frozenlist>=1.1.1 in ./venv/lib/python3.9/site-packages (from aiohttp<4.0.0,>=3.11.13->realtime<3.0.0,>=2.0.0->supabase>=2.0.0->-r requirements.txt (line 8)) (1.5.0)
Requirement already satisfied: aiosignal>=1.1.2 in ./venv/lib/python3.9/site-packages (from aiohttp<4.0.0,>=3.11.13->realtime<3.0.0,>=2.0.0->supabase>=2.0.0->-r requirements.txt (line 8)) (1.3.2)
Requirement already satisfied: multidict<7.0,>=4.5 in ./venv/lib/python3.9/site-packages (from aiohttp<4.0.0,>=3.11.13->realtime<3.0.0,>=2.0.0->supabase>=2.0.0->-r requirements.txt (line 8)) (6.1.0)
Requirement already satisfied: propcache>=0.2.0 in ./venv/lib/python3.9/site-packages (from aiohttp<4.0.0,>=3.11.13->realtime<3.0.0,>=2.0.0->supabase>=2.0.0->-r requirements.txt (line 8)) (0.3.0)
Requirement already satisfied: attrs>=17.3.0 in ./venv/lib/python3.9/site-packages (from aiohttp<4.0.0,>=3.11.13->realtime<3.0.0,>=2.0.0->supabase>=2.0.0->-r requirements.txt (line 8)) (25.3.0)
Requirement already satisfied: yarl<2.0,>=1.17.0 in ./venv/lib/python3.9/site-packages (from aiohttp<4.0.0,>=3.11.13->realtime<3.0.0,>=2.0.0->supabase>=2.0.0->-r requirements.txt (line 8)) (1.18.3)
Requirement already satisfied: greenlet!=0.4.17 in ./venv/lib/python3.9/site-packages (from SQLAlchemy<3,>=1.4->langchain>=0.3.0->-r requirements.txt (line 3)) (3.1.1)
Requirement already satisfied: exceptiongroup>=1.0.2 in ./venv/lib/python3.9/site-packages (from anyio->httpx<0.29,>=0.26->supabase>=2.0.0->-r requirements.txt (line 8)) (1.2.2)
Requirement already satisfied: sniffio>=1.1 in ./venv/lib/python3.9/site-packages (from anyio->httpx<0.29,>=0.26->supabase>=2.0.0->-r requirements.txt (line 8)) (1.3.1)
WARNING: You are using pip version 21.2.4; however, version 25.0.1 is available.
You should consider upgrading via the '/Users/liusai/hr-hiic/hiic-hr-app/backend/venv/bin/python3 -m pip install --upgrade pip' command.
INFO:     Will watch for changes in these directories: ['/Users/liusai/hr-hiic/hiic-hr-app/backend']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [80200] using StatReload
/Users/liusai/hr-hiic/hiic-hr-app/backend/venv/lib/python3.9/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
  warnings.warn(
/Users/liusai/hr-hiic/hiic-hr-app/backend/app/services/chat_service.py:16: LangChainDeprecationWarning: Please see the migration guide at: https://python.langchain.com/docs/versions/migrating_memory/
  self.memory = ConversationBufferMemory(
OpenRouter API密钥前10个字符: sk-or-v1-d...
OpenRouter API请求头: {'Content-Type': 'application/json', 'Authorization': 'Bearer sk-or-v1-d...', 'HTTP-Referer': 'https://hiic-hr.app', 'X-Title': 'HIIC HR AI App'}
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
数据分析服务：成功加载299条员工记录
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
INFO:     Started server process [80202]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
收到增强版聊天请求: 公司哪个部门男生比例最高，哪个部门女生比例最高
发送消息到OpenRouter: 公司哪个部门男生比例最高，哪个部门女生比例最高
发送到OpenRouter的消息:
消息 1 - 角色: system, 内容前50个字符: 你是HIIC公司内部HR系统的AI助手，名叫"小智"。你的性格友好、专业且有亲和力。你的回答必须基于...
消息 2 - 角色: system, 内容前50个字符: 你现在可以使用以下工具来帮助回答用户的问题：

工具名称: get_basic_stats
描述: ...
消息 3 - 角色: assistant, 内容前50个字符: 您好！我是中心HR助手 Cool ，请问有什么可以帮助您的？...
消息 4 - 角色: user, 内容前50个字符: 公司哪个部门男生比例最高，哪个部门女生比例最高...
发送请求到OpenRouter API: https://openrouter.ai/api/v1/chat/completions
使用模型: google/gemini-2.0-flash-exp:free
消息数量: 4
OpenRouter API响应状态码: 200
获取AI回复失败: object str can't be used in 'await' expression
错误详情: Traceback (most recent call last):
  File "/Users/liusai/hr-hiic/hiic-hr-app/backend/app/services/enhanced_chat_service.py", line 147, in get_response
    initial_response = await openrouter_service.get_chat_response(full_messages)
TypeError: object str can't be used in 'await' expression

返回增强版聊天响应: 抱歉，处理您的请求时出现了问题。请稍后再试。...
INFO:     127.0.0.1:54877 - "POST /api/enhanced-chat HTTP/1.1" 200 OK
收到增强版聊天请求: 公司哪个部门的男生最多，共多少人
发送消息到OpenRouter: 公司哪个部门的男生最多，共多少人
发送到OpenRouter的消息:
消息 1 - 角色: system, 内容前50个字符: 你是HIIC公司内部HR系统的AI助手，名叫"小智"。你的性格友好、专业且有亲和力。你的回答必须基于...
消息 2 - 角色: system, 内容前50个字符: 你现在可以使用以下工具来帮助回答用户的问题：

工具名称: get_basic_stats
描述: ...
消息 3 - 角色: user, 内容前50个字符: 公司哪个部门的男生最多，共多少人...
发送请求到OpenRouter API: https://openrouter.ai/api/v1/chat/completions
使用模型: google/gemini-2.0-flash-exp:free
消息数量: 3
OpenRouter API响应状态码: 200
获取AI回复失败: object str can't be used in 'await' expression
错误详情: Traceback (most recent call last):
  File "/Users/liusai/hr-hiic/hiic-hr-app/backend/app/services/enhanced_chat_service.py", line 147, in get_response
    initial_response = await openrouter_service.get_chat_response(full_messages)
TypeError: object str can't be used in 'await' expression

返回增强版聊天响应: 抱歉，处理您的请求时出现了问题。请稍后再试。...
INFO:     127.0.0.1:54883 - "POST /api/enhanced-chat HTTP/1.1" 200 OK
WARNING:  StatReload detected changes in 'app/services/enhanced_chat_service.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [80202]
/Users/liusai/hr-hiic/hiic-hr-app/backend/venv/lib/python3.9/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
  warnings.warn(
/Users/liusai/hr-hiic/hiic-hr-app/backend/app/services/chat_service.py:16: LangChainDeprecationWarning: Please see the migration guide at: https://python.langchain.com/docs/versions/migrating_memory/
  self.memory = ConversationBufferMemory(
OpenRouter API密钥前10个字符: sk-or-v1-d...
OpenRouter API请求头: {'Content-Type': 'application/json', 'Authorization': 'Bearer sk-or-v1-d...', 'HTTP-Referer': 'https://hiic-hr.app', 'X-Title': 'HIIC HR AI App'}
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
数据分析服务：成功加载299条员工记录
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
正在从Supabase获取员工数据...
获取到299条员工记录
数据清洗完成
清洗后数据样例 (第一条记录):
  job_change: [']']
  promotion: ['[', '高技术处外派人员-副部长', '2017/01产业发展一部副部长-部长', '2019/01任AI产业研究所所长、科技转化中心部长', '2021/06/18所长-副总工程师', '2022/08/30副总工程师-副主任', ']']
  awards: ['[', '服务之星', '2014', '支撑奉献', '2015', '优秀干部', '2016', '优秀干部', '2017', '优秀干部', '2017', '深圳市发展改革委优秀个人', '2018', '优秀干部', '2018', '深圳市发展改革委先进工作者', '2019', '众志成城奖', '2021', '深圳市发展和改革委员会2021年度考核优秀等次事业单位工作人员', ']']
INFO:     Started server process [80422]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
DataFrame创建成功，列名: ['id', 'name', 'department', 'position', 'gender', 'birth_date', 'age', 'university', 'major', 'education', 'degree', 'first_work_date', 'first_work_month', 'hire_date', 'company_years', 'total_work_years', 'title', 'title_date_old', 'job_change', 'promotion', 'awards', 'is_qs100', 'current_age', 'is_qs50', 'is_985', 'current_work_years', 'current_company_years', 'sequence', 'section', 'ethnicity', 'recruitment_type', 'is_c9', 'is_211', 'major_category', 'team', 'is_business_dept', 'department_normalized', 'education_normalized', 'gender_normalized', 'created_at', '职称/技能_评定时间', '首次参加工作时间_（年假计算用）', '首次参加工作年月_（实际）']
收到增强版聊天请求: 公司哪个部门男生比例最高，哪个部门女生比例最高
发送消息到OpenRouter: 公司哪个部门男生比例最高，哪个部门女生比例最高
发送到OpenRouter的消息:
消息 1 - 角色: system, 内容前50个字符: 你是HIIC公司内部HR系统的AI助手，名叫"小智"。你的性格友好、专业且有亲和力。你的回答必须基于...
消息 2 - 角色: system, 内容前50个字符: 你现在可以使用以下工具来帮助回答用户的问题：

工具名称: get_basic_stats
描述: ...
消息 3 - 角色: assistant, 内容前50个字符: 您好！我是中心HR助手 Cool ，请问有什么可以帮助您的？...
消息 4 - 角色: user, 内容前50个字符: 公司哪个部门男生比例最高，哪个部门女生比例最高...
消息 5 - 角色: assistant, 内容前50个字符: 抱歉，处理您的请求时出现了问题。请稍后再试。...
消息 6 - 角色: user, 内容前50个字符: 公司哪个部门男生比例最高，哪个部门女生比例最高...
发送请求到OpenRouter API: https://openrouter.ai/api/v1/chat/completions
使用模型: google/gemini-2.0-flash-exp:free
消息数量: 6
OpenRouter API响应状态码: 200
收到OpenRouter初始回复: 这个问题比较复杂，我需要分析每个部门的性别比例才能得出结论。这个我暂时无法回答。...
返回增强版聊天响应: 这个问题比较复杂，我需要分析每个部门的性别比例才能得出结论。这个我暂时无法回答。...
INFO:     127.0.0.1:55067 - "POST /api/enhanced-chat HTTP/1.1" 200 OK
