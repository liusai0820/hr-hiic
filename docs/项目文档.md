# HIIC HR AI助手项目文档

## 1. 系统架构

### 1.1 前端架构
- 基于Next.js构建的现代化Web应用
- 使用TypeScript确保类型安全
- 采用TailwindCSS进行样式设计
- 使用Material-UI组件库提供高质量UI组件

### 1.2 后端架构
- FastAPI作为主要Web框架
- Supabase提供数据库和认证服务
- OpenRouter集成多个AI模型服务
- SQLite用于本地数据缓存和查询优化

### 1.3 AI服务架构
- 分层模型选择策略:
  - 问题分类: google/gemma-3-7b-it (轻量级)
  - 通用对话: google/gemma-3-27b-it (中等规模)
  - SQL生成: anthropic/claude-3-opus (高精度)
  - 混合服务: anthropic/claude-3-sonnet (通用能力)
  - 备用模型: openai/gpt-4-turbo (兜底方案)

## 2. 核心组件

### 2.1 前端组件

#### 2.1.1 页面组件
- `app/page.tsx`: 首页,展示系统概览和功能入口
- `app/chat/page.tsx`: AI对话界面,支持实时对话和历史记录
- `app/profile/setup/page.tsx`: 用户信息设置页面
- `app/admin/users/page.tsx`: 管理员用户管理界面
- `app/admin/register/page.tsx`: 管理员注册页面

#### 2.1.2 对话组件
- `components/dialogs/BirthdayEmployeeDialog.tsx`: 生日员工展示对话框
- `components/dialogs/EmployeeListDialog.tsx`: 员工列表对话框

#### 2.1.3 工具组件
- `utils/avatarUtils.ts`: 头像生成工具

### 2.2 后端组件

#### 2.2.1 API路由
- `api/admin.py`: 管理员相关API
- `api/chat.py`: 聊天功能API
- `api/employees.py`: 员工管理API

#### 2.2.2 服务层
- `services/sql_service.py`: SQL查询服务
  - 支持自然语言转SQL
  - 查询结果缓存机制
  - 错误修复和重试机制
  - 部门统计优化路径
  
- `services/openrouter_service.py`: AI模型调用服务
  - 多模型协同
  - 自动重试和故障转移
  - 响应格式化

### 2.3 数据模型

#### 2.3.1 用户模型
```typescript
interface User {
  id: string;
  email: string;
  user_metadata?: {
    姓名?: string;
    性别?: string;
    年龄?: number;
    部门?: string;
    职位?: string;
  };
}
```

#### 2.3.2 员工模型
```typescript
interface Employee {
  id: string;
  name: string;
  性别: string;
  年龄: number;
  部门: string;
  职位: string;
  学历?: string;
  入职日期?: string;
  工作年限?: number;
}
```

## 3. 功能更新日志

### 3.1 AI对话优化
- 实现多模型协同策略
- 添加查询结果缓存机制
- 优化部门统计查询路径
- 改进自然语言生成质量

### 3.2 用户体验优化
- 添加生日提醒功能
- 优化头像生成逻辑
- 改进错误提示信息
- 添加加载状态反馈

### 3.3 安全性增强
- 完善会话管理机制
- 增加SQL注入防护
- 优化权限控制逻辑

### 3.4 性能优化
- 实现查询结果缓存
- 优化数据库索引
- 改进API响应时间

## 4. 开发指南

### 4.1 环境配置
```bash
# 前端开发环境
cd frontend
npm install
npm run dev

# 后端开发环境
cd backend
pip install -r requirements.txt
python main.py
```

### 4.2 关键配置项
- `SUPABASE_URL`: Supabase服务地址
- `SUPABASE_KEY`: Supabase API密钥
- `OPENROUTER_API_KEY`: OpenRouter API密钥
- `API_PORT`: 后端服务端口

### 4.3 开发规范
1. 使用TypeScript进行前端开发
2. 遵循ESLint和Prettier代码规范
3. 使用Python3.8+进行后端开发
4. 遵循PEP 8 Python代码规范

### 4.4 测试规范
1. 单元测试覆盖核心业务逻辑
2. 集成测试确保组件间协作
3. E2E测试验证关键用户流程

## 5. 部署指南

### 5.1 生产环境要求
- Node.js 16+
- Python 3.8+
- PostgreSQL 13+
- Redis (可选,用于缓存)

### 5.2 部署步骤
1. 构建前端资源
2. 配置环境变量
3. 初始化数据库
4. 启动应用服务

### 5.3 监控和维护
- 使用PM2进行进程管理
- 配置日志收集和分析
- 设置性能监控
- 定期数据备份

## 6. 后续开发计划

### 6.1 功能增强
- [ ] 绩效分析模块
- [ ] 人才发展追踪
- [ ] 培训管理系统
- [ ] 招聘流程自动化

### 6.2 技术优化
- [ ] 引入GraphQL API
- [ ] 优化AI模型选择策略
- [ ] 增强数据分析能力
- [ ] 改进缓存机制

### 6.3 用户体验
- [ ] 移动端适配优化
- [ ] 深色模式支持
- [ ] 自定义主题
- [ ] 多语言支持 